<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<!-- <script src="https://psyc241.ucsd.edu/Chaipat/TB_PCL_vWM_delays/js/vismemCC.js"></script> -->
<script src="https://timbrady.org/turk/TimTurkTools.js"></script>
<script src="vismemCC_simon.js"></script>
<!--
//////////////////////////////////////////////////////////////////////////////////
-->

<style>
    .trialDiv {
      /* border: 2px solid gray;*/
      border: 0px;
      padding: auto;
      width: auto;
      position: relative;
      top: 50px;
      left: 50%;
      /* bring your own prefixes */
      transform: translate(-50%, -50%);
      text-align: center;
      display: none;
      font-size: 12pt;
    }

    body {
      font-family: Arial, Helvetica;
      font-size: 12pt;
    }

    #submitButton {
      display: none;
    }

    #instructions {
      width: 80%;
      margin: 0 auto;
      text-align: center;
      margin-top: 150px;
      font-size: 14pt;
    }

    .consent {
      margin-top: 20px;
      margin-left: 280px;
      margin-right: 280px;
      height: 145px;
      border: 2px solid rgb(109, 108, 108);
      overflow: scroll;
      padding: 15px;
    }

    #headerConsent {
      font-size: 15pt;
    }

    #startExperiment {
      color: rgb(200,200,200);
      text-decoration: none;
    }

    #startExperiment:hover{
      color: white;
    }

    #startExperimentButton {
      width: 200px;
      text-align: center;
      border: 4px outset gray;
      background: gray;
      padding: 5px;
      margin: 0 auto;
      font-size: 12pt;
    }

    #myCanvas{
      width: 400;
      height: 400;
      margin-top: 80px;
      cursor: default;
      border: rgb(255, 255, 255);
      outline-width: 2px;
      outline-color: rgb(255, 255, 255);
    }

    .continueExp:hover{
      color: rgb(255, 255, 255);
      text-decoration-line: none;
    }

    .continueExp {
      color: rgb(200,200,200);
      color: black;
      width: 200px;
      text-align: center;
      padding: 5px;
      margin: 0 auto;
      text-decoration: none;
    }

    .continueButton {
      width: 100px;
      text-align: center;
      border: 4px outset gray;
      background: gray;
      padding: 5px;
      margin: 0 auto;
    }

    #meter{
    width: 10cm;
    height: 10cm;
    }

    .instr {
      display: none;
    }
    #done {
    display: none;
    }

    #clickButton {
      opacity: 0.3;
      /* filter: alpha(opacity=30); */
    }

  

</style>

<div id="done" class="taskDiv">
Saving data...
</div>


<input type="submit" value="Submit" name="submitButton" id="submitButton" style="display: none">


  <div id="instructions">
    <h2> GO! NOGO! 
      <br>เกมวัดความว่องไวและความแม่นยำในการตอบสนอง</h2>
    <p>ต่อจากนี้จะมีวงกลมปรากฏขึ้นมา 
    <br>ให้ท่าน <b>"กดลงบนปุ่ม"</b> เมื่อมี <b>สีเขียว</b> ปรากฏขึ้นมา และ <b>"ห้ามกดปุ่ม"</b> โดยเด็ดขาดเมื่อมี <b>สีแดง</b> ปรากฏขึ้นมา</p>
      
    <p> ขอให้ท่านสำรวจสถานที่ที่ท่านอยู่ว่ามีสิ่งที่จะรบกวนสมาธิของท่านหรือไม่
    <br>หากท่านอยู่ในสถานที่ที่พร้อมแล้ว
    <br> กดปุ่ม <b>"เริ่ม"</b> เพื่อเข้าสู่การทดสอบ</p>
  </div>
  
  <div id="startExperimentButton">
    <a href="#" id="startExperiment">เริ่ม</a>
  </div>

  <audio id="audio" src="click.mp3"></audio>
  <audio id="click" src="click.mp3"></audio>

  <div class="consent">
    <p align="center" id = headerConsent><b>คณะแพทยศาสตร์ จุฬาลงกรณ์มหาวิทยาลัย
      <br>ยินยอมให้ดำเนินการวิจัย</b>
      <p>
      <br><b>เรียนผู้เข้าร่วมวิจัยทุกท่าน </b>
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ดร.นพ.ชัยภัทร ชุณหรัศมิ์ สาขาประสาทวิทยา ภาควิชาอายุรศาสตร์ คณะแพทยศาสตร์ จุฬาลงกรณ์มหาวิทยาลัย <br>กำลังทำการศึกษาวิจัยเพื่อหาข้อมูลเพิ่มเติมเกี่ยวกับการู้คิด สมาธิ และความจำ
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ท่านได้รับเชิญให้เข้าร่วมในโครงการวิจัยนี้เนื่องจากท่านเป็นผู้สูงอายุไทยที่มีอายุ 55 ปีขึ้นไป ที่เข้ารับบริการตรวจรักษา <br>ในคลินิกผู้สูงวัยสุขภาพดี หรือคลินิกโรคสมองเสื่อม หรือคลินิกความจำ หรือคลินิกพาร์กินสัน หรือศูนย์ประสาทศาสตร์ <br>โรงพยาบาลจุฬาลงกรณ์ สภากาชาดไทย ก่อนที่ท่านจะตัดสินใจเข้าร่วมในการศึกษาวิจัยดังกล่าว ขอให้ท่านอ่านเอกสารฉบับนี้อย่างถี่ถ้วน เพื่อให้ท่านได้ทราบถึงเหตุผลและรายละเอียดของการศึกษาวิจัยในครั้งนี้ หากท่านมีข้อสงสัยใด ๆ เพิ่มเติม <br>กรุณาซักถามจากทีมงานของแพทย์ผู้ทำวิจัย หรือแพทย์ผู้ร่วมทำวิจัยซึ่งจะเป็นผู้สามารถตอบคำถามและให้ความกระจ่างแก่ท่านได้
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ท่านสามารถขอคำแนะนำในการเข้าร่วมโครงการวิจัยนี้จากครอบครัว เพื่อน หรือแพทย์ประจำตัวของท่านได้ <br>ท่านมีเวลาอย่างเพียงพอในการตัดสินใจโดยอิสระ ถ้าท่านตัดสินใจแล้วว่าจะเข้าร่วมในโครงการวิจัยนี้ <br>ขอให้ท่านลงนามในเอกสารแสดงความยินยอมของโครงการวิจัยนี้</p>
  
      <p>
      <br><b>ขั้นตอนการวิจัย</b> 
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;หากท่านยินยอมที่จะเข้าร่วมในการศึกษาโครงการวิจัยนี้ ท่านจะได้รับคำอธิบายเกี่ยวกับรายละเอียดดังต่อไปนี้
      <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&emsp; 1. ท่านจะเห็นรายละเอียดคำสั่งแสดงวิธีการเก็บข้อมูลในเว็บเบราว์เซอร์ของท่าน 
      <br> &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&emsp; 2. ท่านจะพยายามรับรู้และจดจำคำอธิบายเหล่านี้ และตอบสนองด้วยการกดปุ่ม คลิกเมาส์ หรือสัมผัสหน้าจอ<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ในลักษณะที่จะอธิบายให้ท่านทราบ</p>
  
      <p>
      <br> <b>ความเสี่ยง</b> 
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ท่านจะใช้เว็บเบราว์เซอร์ของท่านในการตอบกลับ ในช่วงเวลาสั้น ๆ เท่านั้น ดังนั้นจึงไม่มีความเสี่ยงหรือความไม่สบายใจ<br>ที่อาจเกิดขึ้นได้ ยกเว้นคำสั่งบางอย่างที่ให้ท่านทำอาจน่าเบื่อเล็กน้อย อย่างไรก็ตาม อาจมีความเสี่ยงที่ไม่สามารถคาดการณ์ได้<br>ในขณะเข้าร่วมโครงการวิจัย</p>
  
      <p>
      <br><b>ค่าใช้จ่าย/ค่าตอบแทน</b> 
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ไม่มีค่าใช้จ่ายใด ๆ เพิ่มขึ้นนอกเหนือจากค่าใช้จ่ายในการรักษาตามปกติ และท่านจะได้รับเงินค่าตอบแทน<br>จากการเข้าร่วมในโครงการวิจัยเป็นจำนวนเงิน 500 บาท/ท่าน</p>
  
      <p>
      <br><b>สิทธิ์ของผู้เข้าร่วมในโครงการวิจัย</b> 
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ท่านสามารถติดต่อ Cognitive Clinical & Computational Neuroscience ได้ที่อีเมล cccnlab@gmail.com เพื่อสอบถามเกี่ยวกับสิทธิ์ของท่านในหัวข้อการวิจัยหรือเพื่อรายงานปัญหาที่เกี่ยวข้องกับการวิจัย</p>
      
      <p>
      <br><b>ประโยชน์ที่อาจได้รับ</b>
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ท่านจะไม่ได้รับประโยชน์ใด ๆ จากการเข้าร่วมในการวิจัยครั้งนี้ แต่ผลการศึกษาที่ได้จะถูกนำไปใช้เพื่อพัฒนาเครื่องมือ<br>ในการประเมินความสามารถทางการรู้คิด นอกจากนี้ความรู้นี้อาจมีประโยชน์ต่อสังคมในด้านต่างๆ ตั้งแต่การปรับปรุงการประเมินเพื่อช่วยในการวินิจฉัยโรคของแพทย์ และเป็นประโยชน์ต่อผู้ป่วยมากขึ้นในอนาคต</p>
  
      <p>
      <br><b>คำอธิบาย</b> 
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ผู้วิจัยได้อธิบายการศึกษานี้ให้ท่านฟังและตอบคำถามของท่าน หากท่านมีคำถามเกี่ยวกับการวิจัยหรือปัญหาที่เกี่ยวข้อง<br>กับการวิจัย รวมถึงเหตุการณ์ไม่พึงประสงค์ใดๆ คุณสามารถติดต่อ ดร.นพ.ชัยภัทร ชุณหรัศมิ์  ได้ที่ cccnlab@gmail.com</p>
  
      <p>
      <br><b>ลักษณะการมีส่วนร่วมโดยสมัครใจ</b>
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;การมีส่วนร่วมในโครงการวิจัยเป็นไปโดยสมัครใจทั้งหมด หากท่านขอยกเลิกการให้คำยินยอมหลังจากที่ท่านได้เข้าร่วมโครงการวิจัยแล้ว ข้อมูลส่วนตัวของท่านจะไม่ถูกบันทึกเพิ่มเติม อย่างไรก็ตามข้อมูลอื่น ๆ ของท่านอาจถูกนำมาใช้เพื่อประเมินผลการวิจัย และท่านจะไม่สามารถกลับมาเข้าร่วมในโครงการนี้ได้อีก ทั้งนี้เนื่องจากข้อมูลของท่านที่จำเป็นสำหรับใช้เพื่อการวิจัยไม่ได้ถูกบันทึก</p>
  
      <p>
      <br><b>การปกป้องรักษาข้อมูลความลับของอาสาสมัคร</b>
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ข้อมูลที่อาจนำไปสู่การเปิดเผยตัวท่าน จะได้รับการปกปิดและจะไม่เปิดเผยแก่สาธารณชน ในกรณีที่ผลการวิจัยได้รับการตีพิมพ์ ชื่อและที่อยู่ของท่านจะต้องได้รับการปกปิดอยู่เสมอ โดยจะใช้เฉพาะรหัสประจำโครงการวิจัยของท่าน
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;จากการลงนามยินยอมของท่าน ผู้ทำวิจัย และผู้สนับสนุนการวิจัย คณะกรรมการจริยธรรมการวิจัย ผู้ตรวจสอบการวิจัย <br>และหน่วยงานควบคุมระเบียบกฎหมาย สามารถเข้าไปตรวจสอบบันทึกข้อมูลทางการแพทย์ของท่านได้แม้จะสิ้นสุดโครงการวิจัยแล้วก็ตาม โดยไม่ละเมิดสิทธิของท่านในการรักษาความลับเกินขอบเขตที่กฎหมายและระเบียบกฎหมายอนุญาตไว้ 
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;จากการลงนามยินยอมของท่าน แพทย์ผู้ทำวิจัยสามารถบอกรายละเอียดที่เกี่ยวกับการเข้าร่วมโครงการวิจัยนี้ของท่านให้แก่แพทย์ผู้รักษาท่านได้
      </p> 

      <p>
      <br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;กด <b>"ฉันยอมรับ"</b> แสดงว่าท่านมีอายุ 18 ปีขึ้นไป ได้อ่านแบบฟอร์มความยินยอมนี้แล้ว และตกลงที่จะเข้าร่วมในการศึกษา<br>โครงการวิจัยนี้ โปรดพิมพ์สำเนาของหน้านี้เพื่อเก็บไว้เป็นหลักฐาน</p>
      </p>
  </div>
  
<div align="center">
  <canvas id="myCanvas"  width="400" height="400">
    </canvas>
    <p id="instr"></p>
</div>

<div id='frame1'; class='trialDiv'>
    <p> นี้คือปุ่มตามปกติก่อนที่จะมีสัญญาณไฟเขียวหรือไฟแดงปรากฏขึ้นมา
    <div class="continueButton">
      <a href="#" id="cont1" class="continueExp"> ถัดไป </a>
    </div>
    
</div>

<div id='frame2'; class='trialDiv'>
    <p> เมื่อสัญญาณไฟ<b>สีเขียว</b>ปรากฏขึ้น ให้ท่าน <b>"กดบนปุ่ม"</b> ให้เร็วที่สุดเท่าที่จะทำได้
    <div class="continueButton">
      <a href="#" id="cont2" class="continueExp"> ถัดไป </a>
    </div>
</div>

<div id='frame3'; class='trialDiv'>
    <p> ท่านต้องระวัง <b>"ห้ามกดปุ่ม"</b> หากสัญญาณไฟ<b>สีแดง</b>ปรากฏขึ้น 
    <div class="continueButton">
      <a href="#" id="cont3" class="continueExp"> ถัดไป </a>
    </div>
</div>

<div id='frame4'; class='trialDiv'>
    <p> หากท่านเข้าใจแล้ว ให้กดปุ่ม <b>"เข้าสู่การทดสอบ"</b> เพื่อเริ่มการทดสอบ
    <div class="continueButton">
      <a href="#" id="cont4" class="continueExp"> เข้าสู่การทดสอบ </a>
    </div>
</div>

<!-- <div id='frame5'; class='trialDiv'>
    <p> 
    <br> จะเป็นเช่นนี้ไปเรื่อยๆ 
    <br> พร้อมไหม

    <div class="continueButton">
      <a href="#" id="cont5" class="continueExp"> ไปค่ะพี่สุชาติ </a>
    </div>
</div>

<div id='rule0'; class='trialDiv'>
    <p> 
    <br> ถ้าพื้นหลังเป็น <font color=darkgreen> <b>สีเขียว</b> </font> ให้กดปุ่ม <b>ตามลำดับ</b> ที่จำไว้
    <br> ถ้าพื้นหลังเป็น <font color=darkred> <b>สีแดง</b> </font> ให้กดปุ่ม <b>ย้อนกลับ</b> จากลำดับที่จำไว้

    <br> <br> กรุณาใช้ <b>เมาส์</b> กดลงบนปุ่ม </p>
</div>

<div id='rule1'; class='trialDiv'>
    <p> 
    <br> ให้กดปุ่มย้อนกลับจากลำดับที่จำไว้
    <br> 
    <br> <br> กรุณาใช้ <b>เมาส์</b> กดลงบนปุ่ม </p>
</div>  -->

<p id="debug"></p>
        <form id="record" action="examplePause.php" name="nextpage" method="post">
            <input type="hidden" id="targ" name="targ" value='[0,0,0,0,0,0,0,0,0,0,0,0]'>
            <input type="hidden" id="resp" name="resp" value='[0,0,0,0,0,0,0,0,0,0,0,0]'>
            <input type="hidden" id="targAng" name="targAng" value='[0,0,0,0,0,0,0,0,0,0,0,0]'>
            <input type="hidden" id="respAng" name="respAng" value='[0,0,0,0,0,0,0,0,0,0,0,0]'>
            <input type="hidden" id="rt" name="rt" value='0'>
        </form>


<script type="text/javascript">
      
    // Settings
    var code = "CC" + Math.round(Math.random()*100000) + "92";
    // var task='Simon';
    var c1=document.getElementById("myCanvas");
    var ctx1=c1.getContext("2d");   
    var centerX=c1.width/2;
    var centerY=c1.height/2;   
    // var width=c1.width;
    // var height=c1.height;
    // var objSize= 100; 
    // var objDist= 120;
    //var visualang = Math.round((Math.atan(((objSize))/objDist))*(180/Math.PI));
    // var wheelRad=objSize+objDist+30;
    // var nubX=null;
    // var nubY=null;
    // var nTrials = 5;
    // var numDots=6;
    // var thetadiff = 360/numDots;
    // var nSeq = 4;
    // var circRot= 0;
    // var colRot= 0;

    //var nullcolor = []; for (var idot =0; idot<numDots;idot++){nullcolor[idot] = '#FFFFFF'}
    // const testtemp = []; for (var idot =0; idot<numDots;idot++){testtemp[idot] = 99999}

    // var stimdur = 500;
    // var delay = 500;

    var rt=[];
    var moveLast=0; // vismen error
    
    // var initTime=3000;
    // var presTime=1000;
    // var delayTime=1000;
    // var feedbacktime=1000;
    var buttonColors =['#FFFFFF','#73FA78','#FF9E98'];
    var buttonShadow = [5,5,5];
    var buttonShadow2 = 5;
    var beepSound = 'audio';
    // var buttonClickColor = '#FFFFFFFF';
    // var buttonShadowOnClick = 2;

    // var bgcolor = ["#f1959b","#8abaae"];
    // var bgx = Math.round(Math.random());
    var isTest=false; // vismen error
    var isTrain = false; // vismen error
    var currProbe=-1; // vismen error
    var curTrial = 0;
    var realstimtime =[]; 
    // var realdelaytime =[];

    var nsec = 180;        // duration sec เวลาทั้งหมดในการเล่น (s)
    var blockDur = 2;     // sec เข้าใจว่าระยะห่างของเวลาการปิ้งแว้บขึ้นของแต่ละตัว (ยิ่งเยอะตัวปิ้งแว้บยิ่งน้อย)
    var changeRate = 0.75; // % changes 
    var nogoRate = 0.25;   // % nogo 
    var dur = 700;        // stay up for ... msec เวลาที่ปิ๊งแว้บขึ้นมา (ms)
    var nBlock = Math.round(nsec/blockDur);  // number of blocks จำนวนการปิ้งแว้บทั้งหมด
    var jitDur = blockDur*1000-dur;   // jitter duration ระยะเวลาในการกด?
    var nNogo = Math.round(nBlock*changeRate*nogoRate);
    var nGo = Math.round(nBlock*changeRate*(1-nogoRate));
    var nNochange = nBlock-nGo-nNogo;

    var timeVec = []; for (var idot =0; idot<nsec;idot++){timeVec[idot] = idot*blockDur*1000}
    var jitters = []; for (var idot =0; idot<nsec;idot++){jitters[idot] = Math.random()*jitDur}
    var timeJit = []; for (var idot =0; idot<nsec;idot++){timeJit[idot] = timeVec[idot]+jitters[idot]}
    var tempevent = []; 
    for (var i2 = 0; i2<nNogo; i2++){tempevent.push(2)}
    for (var i1 = 0; i1<nGo; i1++){tempevent.push(1)}
    for (var i0 = 0; i0<(nNochange-1); i0++){tempevent.push(0)}
    Shuffle(tempevent)
    eventId = [0];
    eventId = eventId.concat(tempevent)

    // Object positions
    
    // Define positions before rotation
    // xTemp=[];
    // yTemp=[];
    // var theta = [];
    // for(i=0;i<numDots;i++){
    //    theta.push(Math.round(( ((2*Math.PI/numDots)*i))*(180/Math.PI)))
    //    xTemp.push(objDist*Math.cos((2*Math.PI/numDots)*i));
    //    yTemp.push(objDist*Math.sin((2*Math.PI/numDots)*i))
    //}

    // Rotate positions
    // xPos=[];
    // yPos=[];
    
    //for(i=0;i<numDots;i++){
    //    xPos.push(centerX-(Math.cos(circRot)*xTemp[i])+(Math.sin(circRot)*yTemp[i]));
    //    yPos.push(centerY+(Math.sin(circRot)*xTemp[i])+(Math.cos(circRot)*yTemp[i]))
    //}

    //function shuffle(array) {
    //  var currentIndex = array.length, temporaryValue, randomIndex;

      // While there remain elements to shuffle...
    //  while (0 !== currentIndex) {

        // Pick a remaining element...
    //    randomIndex = Math.floor(Math.random() * currentIndex);
    //    currentIndex -= 1;

        // And swap it with the current element.
    //    temporaryValue = array[currentIndex];
    //    array[currentIndex] = array[randomIndex];
    //    array[randomIndex] = temporaryValue;
    //  }
    //  return array;
    // }

    // function paintcolor(colAng){
    //   var color=[];
    //   for(ic=0;ic<colAng.length;ic++){
    //      if (colAng[ic] == 99999){
    //          color[ic]='#FFFFFF'
    //      }else{
    //          color[ic]=angle2HEX(colAng[ic])
    //     }
    //  }
    //  return color 
    // }

    // function makeCircles(currColor){
      // Draw circles

    //   for(i=0;i<numDots;i++){
    //      makeCircle('dot'+i,xPos[i],yPos[i],objSize+2,false,0,'#000000','#000000');
    //      makeCircle('dotIn'+i,xPos[i],yPos[i],objSize,false,0,currColor[i],currColor[i]);
    //      // makeCircle('dotIn'+i,xPos[i],yPos[i],objSize,false,0,currColor[i],currColor[i]);
    //  }
    // }

    function makeButton(buttonColor,buttonShadow){
      makeCircle('button',centerX,centerY,150+buttonShadow2,false,12,'#FFFFFF','#000000');
      makeCircle('button',centerX,centerY,150,false,0,'#C4C4C4','#C4C4C4');
      makeCircle('button',centerX+2,centerY+buttonShadow,100,false,0,'#000000','#C4C4C4');   
      makeCircle('button',centerX,centerY,100,false,0,buttonColor,buttonColor);
    }

    // function makeBackground(bgcolor){
      // Fill background
      //    makeRectangle('bg',centerX,centerX,400,400,false,bgcolor,bgcolor);
        
    //}

    // function makeCrosshair(){
      // Draw rectangles
      // for(i=0;i<numDots;i++){
      //    makeRectangle('cross1',centerX,centerX,2,10,false,'#000000','#000000');
      //    makeRectangle('cross2',centerX,centerY,10,2,false,'#000000','#000000');
      //}
    // }

      var st=null; // vismen prob
      function startTime(){
        var d = new Date();
        st=d.getTime();
    }

    function endTime(){ // vismen prob
        var d = new Date();
        timeDif=d.getTime()-st;
        return timeDif;
    }

    let testingSpace = document.getElementById("myCanvas");
    testingSpace.addEventListener('mousedown', pressMeHard);
    function pressMeHard(event){
      var beepSound = document.getElementById("audio");
      beepSound.play();
      // inBound = event.target.id == 'myCanvas';
      Feedback();
      
    }

    function Feedback(){    
        // Remove stimuli
      // setTimeout(function(){
          makeButton();
          drawObjects(ctx1,objects);
          //erase(objects);
          for (iSeq = 0;iSeq < nBlock; iSeq++){  
          // beGone(timeJit[iSeq]);
          beGone(100);
        }
      // },)
    }

    function beGone(ms){
      setTimeout(function(){
          erase(ctx1);
          clear();
          makeButton(buttonColors[0],buttonShadow[0])
          drawObjects(ctx1,objects);
          // var dST = new Date();
          // realstimtime.push(dST.getTime()-STT);
          // var dST2 = new Date();
          // ST2 = dST2.getTime();
      },ms)
    }

    // document.addEventListener('mouseup', releaseMe);
    // function releaseMe(event){
      //  colorClickOut();
    // }

    // function colorClick (color,shadow){
    //   makeButton();
    //   drawObjects(ctx1,objects);
    // }

    // function colorClickOut (color,shadow){
      // clear(colorClick);
    // }
    
    function trialIsOver() {
        
        // Initial
        erase(ctx1);
        clear();
        drawObjects(ctx1,objects);
        $('#rule0').hide();
        $('#rule1').hide();
        // var curtrialStruct = {};
        
        // curtrialStruct.colordist = colordist;
        // curtrialStruct.stimdur = stimdur;
        // curtrialStruct.delaytime = alltrldel[curTrial];
        // curtrialStruct.targcol = alltrlseq[curTrial];
        // curtrialStruct.testpos = alltstpos[curTrial];
        // curtrialStruct.trlrot = alltrlrot[curTrial];
        // curtrialStruct.colorwrot = allcolorwrot[curTrial];
        // curtrialStruct.tarcode = alltarcode[curTrial];
        // curtrialStruct.resp = allselCol[curTrial];
        // curtrialStruct.respAng = allcolAng[curTrial];
        // curtrialStruct.rt = rt[curTrial];
        // curtrialStruct.realstim = realstimtime[curTrial];
        // curtrialStruct.delaytimeReal = realdelaytime[curTrial];
        // trialStruct.push(curtrialStruct);


        // document.getElementById('targ').value=JSON.stringify(color);
        // document.getElementById('resp').value=JSON.stringify(selColor);
        // document.getElementById('respAng').value=JSON.stringify(selAng);
        // document.getElementById('targAng').value=JSON.stringify(targAng);
        // document.getElementById('rt').value=JSON.stringify(rt);

        // curTrial = curTrial+1 ; 

        if (nsec == 300){
            Done();
            // $('#submitButton'.show());
        } else {
            // var selColor=[];var selAng=[];
            // for (var item=0;item<numDots;item++){selColor[item]='#FFFFFF';selAng[item]=null};
            // $('#rule0').hide();
            // $('#rule1').hide();
            showTrial(curTrial);
            startTrialTime = new Date();
        }

    }

    function showTrial(){
        // isTest= false;
        
        erase(ctx1);
        clear();
        
        makeButton(buttonColors[0],buttonShadow[0])
        drawObjects(ctx1,objects);
        for (iSeq=0;iSeq < nBlock; iSeq++){  
          initialT(timeJit[iSeq],buttonColors[eventId[iSeq]],buttonShadow[eventId[iSeq]]);
          RemoveStim(timeJit[iSeq]+dur);
        }
    }

    function initialT(waittime,color,shadow){
      // Initial
      setTimeout(function(){
          // Draw stimuli
          erase(ctx1);
          clear();
          makeButton(color,shadow)
          drawObjects(ctx1,objects);
          var dT = new Date();
          STT=dT.getTime();
      },waittime);
    }
      
    function RemoveStim(waittime2){    
      // Remove stimuli
      setTimeout(function(){
          erase(ctx1);
          clear();
          makeButton(buttonColors[0],buttonShadow[0])
          drawObjects(ctx1,objects);
          var dST = new Date();
          realstimtime.push(dST.getTime()-STT);
          var dST2 = new Date();
          ST2 = dST2.getTime();
      },waittime2);
    }

    //   function Cue(waittime3){
    //     //  Cue
    //      setTimeout(function(){
    //         var dST3 = new Date();
    //         realdelaytime.push(dST3.getTime()-ST2);
    //         erase(ctx1);
    //         clear();
            
    //         currProbe=0;
    //         moveLast = 0 ;
    //         makeBackground(bgcolor[bgx])
    //         makeCircles(nullcolor);
    //         makeCrosshair();
    //         drawObjects(ctx1,objects);
            
            
    //         startTime();
    //         console.log('now!')
    //         isTest=true;
    //      },waittime3);
    // }

    function showFirstTrial() {
        // isTrain = false;


        // Draw first fixation 
        // makeCrosshair();
        // drawObjects(ctx1,objects);

        // Begin
        $('#frame4').hide();
        showTrial();
        startTrialTime = new Date();
        // $('.trialDiv').hide();
    }

    function showPractice_f1(){
        if ($(window).width() >= 600 && screen.width*0.8 < $(window).width()){
            $('#instructions').hide();
            $('.consent').hide();
            myCanvas.style.border = 'solid' 
              // Draw first button
            makeButton(buttonColors[0],buttonShadow[0]);
            drawObjects(ctx1,objects);
            $('#startExperimentButton').hide();
            $('#frame1').show();
            // Begin
            $('#cont1').on('click',pressed);
            function pressed(){
              showPractice_f2();
            }
        }

    }

    function showPractice_f2(){
        $('#frame1').hide();
        makeButton(buttonColors[1],buttonShadow[0]);
        drawObjects(ctx1,objects);
        $('#frame2').show();
        $('#cont2').click(showPractice_f3);
    }

    function showPractice_f3(){
        $('#frame2').hide();
        makeButton(buttonColors[2],buttonShadow[0]);
        drawObjects(ctx1,objects);
        // erase(ctx1);
        // clear();
        // makeButton(buttonColors[0],buttonShadow[0]);
        // drawObjects(ctx1,objects);
        $('#frame3').show();
        $('#cont3').click(showPractice_f4);
    }

    function showPractice_f4(){

            // isTrain = true;
            // console.log(order)
            $('#frame3').hide();
            makeButton(buttonColors[0],buttonShadow[0]);
            drawObjects(ctx1,objects);
            
            $('#frame4').show();
            $('#cont4').click(showFirstTrial);
    }

    // function showPractice_f5(){
          
    //     $('#frame4').hide();
    //     erase(ctx1);
    //     clear();
    //     makeButton(buttonColors[0],buttonShadow[0]);
    //     drawObjects(ctx1,objects);
    //     $('#frame5').show();
    //     $('#cont5').click(showFirstTrial);
    // }

    function Done() {

        $("#myCanvas").hide();
          $("#done").show();

          var dataToServer = {};
          dataToServer.id = getParameterByName("subjectId"); /* getParameterByName("code") */
          dataToServer.experimenter = 'Chaipat';
          dataToServer.experimentName = 'WMcolordist_delay';
          // dataToServer.curData = JSON.stringify(trialStruct);
          $.post("https://psyc241.ucsd.edu/Turk/save.php", dataToServer, AfterSuccessDataSaving).fail(AfterFailedSaving);
    }

    function AfterSuccessDataSaving() {
      // After they are done, send them here:
      // window.location = "https://ucsd.sona-systems.com/webstudy_credit.aspx?experiment_id=1267&credit_token=805f6634de5a46b3aecffe2818d8d90c&survey_code=" + getParameterByName("code");
      $('#submitButton').show();
      $('#done').html("All done, thanks! Please click submit button.");
      
      console.log("Saved!");
    }

    function AfterFailedSaving() {
      console.log("oops, failed to save");

      // window.location = "https://ucsd.sona-systems.com/webstudy_credit.aspx?experiment_id=1267&credit_token=805f6634de5a46b3aecffe2818d8d90c&survey_code=" + getParameterByName("code");  
      $('#submitButton').show();
      $('#done').html("All done, thanks! Please click submit button.");

    }

    function getParameterByName(name, url) {
        if (!url) url = window.location.href;
        name = name.replace(/[\[\]]/g, "\\$&");
        var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
            results = regex.exec(url);
        if (!results) return null;
        if (!results[2]) return '';
        return decodeURIComponent(results[2].replace(/\+/g, " "));
    }


    // ========================================================= 
    $('#startExperiment').click(showPractice_f1);
    $('.responseButton').click(trialIsOver);
    // =========================================================

    /**
      * Gets a URL parameter from the query string
      */
    function turkGetParam( name, defaultValue ) { 
        var regexS = "[\?&]"+name+"=([^&#]*)"; 
        var regex = new RegExp( regexS ); 
        var tmpURL = window.location.href; 
        var results = regex.exec( tmpURL ); 
        if( results == null ) { 
          return defaultValue; 
        } else { 
          return results[1];    
        } 
    }

    function GetWorkerId() {
      var workerId = turkGetParam( 'workerId', 'NONE' );
      return workerId;
    } 

    function IsTurkPreview() {
      return GetWorkerId() == "NONE";
    } 

    function IsOnTurk() {
      try {
        return ((window.location.host.indexOf('mturk')!=-1) || document.forms["mturk_form"] ||
          (top != self && window.parent.location.host.indexOf("mturk") != -1));
      } catch(err) {
        // insecure content trying to access https://turk probably, so say yes:
        return true;
      }
    }
</script>

